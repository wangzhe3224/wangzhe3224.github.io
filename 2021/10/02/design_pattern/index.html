<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"yoursite.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.18.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Python的视角转载请注明出处。代码见：https:&#x2F;&#x2F;github.com&#x2F;wangzhe3224&#x2F;Python-zhifou&#x2F;tree&#x2F;master&#x2F;src&#x2F;todo&#x2F;design_pattern  引言面向对象设计模式就是一系列的组织类和对象的方法，这些方法的目的就是产生更加清晰，且容易拓展和修改的代码。但是，如果我们翻开设计模式的教科书，我们会发现很多的名词，但是这其中很多的模式仅仅是">
<meta property="og:type" content="article">
<meta property="og:title" content="重拾面向对象设计模式">
<meta property="og:url" content="http://yoursite.com/2021/10/02/design_pattern/index.html">
<meta property="og:site_name" content="FunCoder">
<meta property="og:description" content="Python的视角转载请注明出处。代码见：https:&#x2F;&#x2F;github.com&#x2F;wangzhe3224&#x2F;Python-zhifou&#x2F;tree&#x2F;master&#x2F;src&#x2F;todo&#x2F;design_pattern  引言面向对象设计模式就是一系列的组织类和对象的方法，这些方法的目的就是产生更加清晰，且容易拓展和修改的代码。但是，如果我们翻开设计模式的教科书，我们会发现很多的名词，但是这其中很多的模式仅仅是">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-10-02T00:00:00.000Z">
<meta property="article:modified_time" content="2023-09-26T15:09:48.659Z">
<meta property="article:author" content="FunCoder">
<meta property="article:tag" content="Design Pattern">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://yoursite.com/2021/10/02/design_pattern/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://yoursite.com/2021/10/02/design_pattern/","path":"2021/10/02/design_pattern/","title":"重拾面向对象设计模式"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>重拾面向对象设计模式 | FunCoder</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">FunCoder</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">FunCoder</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%95%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">引言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E9%80%A0%E6%A8%A1%E5%BC%8F%EF%BC%8CCreational-Patterns"><span class="nav-number">2.</span> <span class="nav-text">创造模式，Creational Patterns</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%EF%BC%8CFactory-Method"><span class="nav-number">2.1.</span> <span class="nav-text">工厂方法，Factory Method</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%EF%BC%8CAbstract-Factory"><span class="nav-number">2.2.</span> <span class="nav-text">抽象工厂，Abstract Factory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BB%BA%E9%80%A0%E8%80%85%EF%BC%8CBuilder"><span class="nav-number">2.3.</span> <span class="nav-text">建造者，Builder</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E4%BE%8B%EF%BC%8CSingleton"><span class="nav-number">2.4.</span> <span class="nav-text">单例，Singleton</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E5%9E%8B%EF%BC%8CPrototype"><span class="nav-number">2.5.</span> <span class="nav-text">原型，Prototype</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">2.6.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9E%84%E6%A8%A1%E5%BC%8F%EF%BC%8CStructural-Patterns"><span class="nav-number">3.</span> <span class="nav-text">结构模式，Structural Patterns</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E5%90%88%EF%BC%8CComposite"><span class="nav-number">3.1.</span> <span class="nav-text">组合，Composite</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BD%AC%E6%8D%A2%E5%99%A8%E3%80%81%E6%A1%A5%E6%8E%A5%E3%80%81%E8%A3%85%E9%A5%B0%E5%99%A8%E3%80%81%E4%BB%A3%E7%90%86"><span class="nav-number">3.2.</span> <span class="nav-text">转换器、桥接、装饰器、代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-1"><span class="nav-number">3.3.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%8C%E4%B8%BA%E6%A8%A1%E5%BC%8F%EF%BC%8CBehavior-Patterns"><span class="nav-number">4.</span> <span class="nav-text">行为模式，Behavior Patterns</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E8%80%85%EF%BC%8CVisitor"><span class="nav-number">4.1.</span> <span class="nav-text">访问者，Visitor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%EF%BC%8CObserver"><span class="nav-number">4.2.</span> <span class="nav-text">观察者，Observer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%EF%BC%8CCommand"><span class="nav-number">4.3.</span> <span class="nav-text">命令，Command</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8%EF%BC%8CIterator"><span class="nav-number">4.4.</span> <span class="nav-text">迭代器，Iterator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%87%E5%BF%98%E5%BD%95%EF%BC%8CMemento"><span class="nav-number">4.5.</span> <span class="nav-text">备忘录，Memento</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AD%96%E7%95%A5%EF%BC%8CStrategy"><span class="nav-number">4.6.</span> <span class="nav-text">策略，Strategy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8A%B6%E6%80%81%E6%9C%BA%EF%BC%8CState"><span class="nav-number">4.7.</span> <span class="nav-text">状态机，State</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-2"><span class="nav-number">5.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">6.</span> <span class="nav-text">参考</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">FunCoder</p>
  <div class="site-description" itemprop="description">Youtube / 小红书 / 知乎 同名</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">136</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">93</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/wangzhe3224" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wangzhe3224" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://wangzhe3224.github.io/zhuan-ma/" title="https:&#x2F;&#x2F;wangzhe3224.github.io&#x2F;zhuan-ma&#x2F;" rel="noopener" target="_blank">转码路线图</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://funcoder.net/" title="https:&#x2F;&#x2F;funcoder.net&#x2F;" rel="noopener" target="_blank">FunCoder</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://wangzhe3224.github.io/bitcoin-pro/" title="https:&#x2F;&#x2F;wangzhe3224.github.io&#x2F;bitcoin-pro&#x2F;" rel="noopener" target="_blank">BitcoinPro</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://wangzhe3224.github.io/quant-roadmap/" title="https:&#x2F;&#x2F;wangzhe3224.github.io&#x2F;quant-roadmap&#x2F;" rel="noopener" target="_blank">QuantRoadmap</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://quant.funcoder.net/" title="https:&#x2F;&#x2F;quant.funcoder.net&#x2F;" rel="noopener" target="_blank">QuantBox</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/10/02/design_pattern/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="FunCoder">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FunCoder">
      <meta itemprop="description" content="Youtube / 小红书 / 知乎 同名">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="重拾面向对象设计模式 | FunCoder">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          重拾面向对象设计模式
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-10-02 00:00:00" itemprop="dateCreated datePublished" datetime="2021-10-02T00:00:00Z">2021-10-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-09-26 15:09:48" itemprop="dateModified" datetime="2023-09-26T15:09:48Z">2023-09-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Coding/" itemprop="url" rel="index"><span itemprop="name">Coding</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>17k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>15 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><blockquote>
<p>Python的视角<br>转载请注明出处。<br>代码见：<a target="_blank" rel="noopener" href="https://github.com/wangzhe3224/Python-zhifou/tree/master/src/todo/design_pattern">https://github.com/wangzhe3224/Python-zhifou/tree/master/src/todo/design_pattern</a></p>
</blockquote>
<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>面向对象设计模式就是一系列的组织类和对象的方法，这些方法的目的就是产生更加清晰，且容易拓展和<br>修改的代码。但是，如果我们翻开设计模式的教科书，我们会发现很多的名词，但是这其中很多的模式仅仅<br>是由于语言的限制所产生的的。因为有些语言缺乏函数一等公民或者属于静态类型等等。</p>
<p>尽管如此，学习设计模式仍然非常有用，只不过我们可能需要换一种角度重新审视这些设计模式，去思考<br>这些模式背后的原则：</p>
<ul>
<li>面对接口编程，而不是面对实现</li>
<li>延迟执行，即不到不得不实例化的时候，选择延迟</li>
</ul>
<p>这两个原则不光在面向对象编程中成立，他们在任何一种语言范式中都存在。这两个原则的核心在于如何管理<br>依赖，而管理依赖的方法就是隐藏（或者说封装）和依赖注入。这篇文章我们就讨论如何将这些原则应用到<br>传统的设计模式中：</p>
<ul>
<li>创造模式，Creational Patterns</li>
<li>结构模式，Structural Patterns</li>
<li>行为模式，Behavioral Patterns</li>
</ul>
<h2 id="创造模式，Creational-Patterns"><a href="#创造模式，Creational-Patterns" class="headerlink" title="创造模式，Creational Patterns"></a>创造模式，Creational Patterns</h2><p>创造模式主要是提供一些实例化对象的模式，主要包括：</p>
<ul>
<li>工厂方法</li>
<li>抽象工厂</li>
<li>建造者</li>
<li>原型</li>
<li>单例</li>
</ul>
<p>这些创造模式都是关于实例化一个或者若干个相关的对象的，让我们来看看他们是怎么用到上述两个原则的。<br>下面的小节有如下结构：面临的问题、解决方案、跟原则的关系。由于我们是用Python举例的，Python的<br>很多语言特性，比如鸭子类型、函数一等公民等等，可能会让这些模式看起来与传统的设计模式不太一样，<br>但是，道理是一样的。当然，如果考虑一些更加强大类型系统，比如代数数据类型，很多问题甚至都不存在，<br>比如抽象工厂想要解决的问题，实际上就是 Sum Type 和 Product Type 的组合。。</p>
<h3 id="工厂方法，Factory-Method"><a href="#工厂方法，Factory-Method" class="headerlink" title="工厂方法，Factory Method"></a>工厂方法，Factory Method</h3><p>假设我们有如下类，<code>RobotController</code> 包含一个 <code>Robot</code> 对象，然后可以控制它，<br>比如 <code>some_function</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Robot</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">move</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self&#125;</span> moves.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RobotController</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.robot = Robot()  <span class="comment"># &lt;-- 注意这里，Controller提前实例化的其他的对象，就产生了依赖。</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">some_function</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Play with <span class="subst">&#123;self.robot&#125;</span>&quot;</span>)</span><br><span class="line">        self.robot.move()</span><br></pre></td></tr></table></figure>

<p>看起来不错，现在问题来了，这个Controller现在需要为控制另一种机器人，<code>RobotB</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RobotB</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">move</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self&#125;</span> moves.&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>这时，我们的 controller 类就需要更改代码，才能支持新的 RobotB。其实问题的关键在于<br> controller 过早的实例化 Robot 导致了依赖。这时候我们可以给controller注入一个工厂类，<br> 这个类负责对象的实例化，从而把责任委托给工厂类。而这个工厂类应该是一个抽象（接口）才能保证<br> controller 代码可以实用与更多的不同类型的 Robot。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RobotInterface</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">move</span>():</span></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Robot</span>(<span class="params">RobotInterface</span>):</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">move</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self&#125;</span> moves.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RobotB</span>(<span class="params">RobotInterface</span>):</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">move</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self&#125;</span> moves.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RobotCreator</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;   这个就是所谓的 工厂方法！   &lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span>() -&gt; RobotInterface:</span></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RobotACreator</span>(<span class="params">RobotCreator</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">self</span>) -&gt; RobotInterface:</span></span><br><span class="line">        <span class="keyword">return</span> Robot()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RobotBCreator</span>(<span class="params">RobotCreator</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">self</span>) -&gt; RobotInterface:</span></span><br><span class="line">        <span class="keyword">return</span> RobotB()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RobotController</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, creator: RobotCreator</span>):</span></span><br><span class="line">        <span class="comment"># 原则1：针对抽象编程</span></span><br><span class="line">        <span class="comment"># 原则2：延后对象实例化</span></span><br><span class="line">        <span class="comment"># 原则3：委托责任（给 creator 对象）</span></span><br><span class="line">        self.robot: RobotInterface = creator.create()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">some_function</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Play with <span class="subst">&#123;self.robot&#125;</span>&quot;</span>)</span><br><span class="line">        self.robot.move()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    creator_a = CreatorA()</span><br><span class="line">    creator_b = CreatorB()</span><br><span class="line">    controller = RobotController(creator_a)</span><br><span class="line">    controller.move()</span><br></pre></td></tr></table></figure>

<p>不过，对于Python来说，我们并不需要 <code>Creator</code> 这一层抽象，因为 Python 可以直接传递类。<br>我们可以直接：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 省略 Creator 的版本</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RobotController</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, robot_cls: RobotInterface</span>):</span></span><br><span class="line">        <span class="comment"># 原则1：针对抽象编程</span></span><br><span class="line">        <span class="comment"># 原则2：延后对象实例化</span></span><br><span class="line">        self.robot: RobotInterface = robot_cls() <span class="comment"># 注意这里传递的 class 不是对象</span></span><br><span class="line">        <span class="comment"># 对于 Java 这种类不是一等公民的语言，Creator往往是必须的，因为只能传递对象。</span></span><br><span class="line">        <span class="comment"># 如果使用依赖注入，我们·可以直接传入一个对象，就省略了 （）</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">some_function</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Play with <span class="subst">&#123;self.robot&#125;</span>&quot;</span>)</span><br><span class="line">        self.robot.move()</span><br></pre></td></tr></table></figure>

<p>如果我们使用依赖注入，我们可以直接传入Robot对象，而不是类。</p>
<p>当然，并不是说 <code>Creator</code> 这一层抽象是没有意义的，当我们的对象实例化变得比价复杂的时候，即<br>不是一个 <code>class()</code> 可以搞定的时候，Creator 的工厂方法 <code>create</code> 可以做很多复杂的工作。<br>我举个简单的例子，比如我们希望实例化 RobotB 的时候打印一些信息，我们就可以把相应的逻辑放入<br><code>create</code> 内部，而不需要让其他的类负责。</p>
<p>我再举个例子，如果Robot的构造变得更加复杂了，比如需要组装不同的部件才能获得一个实例，Creator<br>这层抽象就显得是必须的。当然，这里不讨论依赖注入，即使使用依赖注入，直接传递实例化以后的对象，<br>实例化这个对象的复杂度仍然需要一个对象来负责。这里就引出了下一个创造模式：抽象工厂。</p>
<h3 id="抽象工厂，Abstract-Factory"><a href="#抽象工厂，Abstract-Factory" class="headerlink" title="抽象工厂，Abstract Factory"></a>抽象工厂，Abstract Factory</h3><p>我们延续上一个例子，现在机器人变得复杂了，我们需要两个部件组装一个机器人：外壳和灵魂。而每种<br>部件还可能存在不同的类型，比如金属、塑料、液体等等，电子灵魂、人类灵魂等等。这时候为了生产<br>不同的外壳和灵魂组合，我们需要抽象工厂。再一次，对于Python这不是最优雅的实现。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RobotI</span>:</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">move</span>(<span class="params">self</span>):</span></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Robot</span>(<span class="params">RobotI</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, shell, soul</span>):</span></span><br><span class="line">        self.shell = shell</span><br><span class="line">        self.soul = soul</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">move</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Robot with <span class="subst">&#123;self.shell&#125;</span> and <span class="subst">&#123;self.soul&#125;</span> moves&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FactoryI</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_shell</span>(<span class="params">self</span>):</span></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_soul</span>(<span class="params">self</span>):</span></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">self</span>):</span></span><br><span class="line">        shell = self.create_shell()</span><br><span class="line">        soul = self.create_soul()</span><br><span class="line">        <span class="keyword">return</span> Robot(shell, soul)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MetalDigitalRobotFactory</span>(<span class="params">FactoryI</span>):</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_shell</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> MetalShell() </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_soul</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> DigitalSoul()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, factory: FactoryI</span>):</span></span><br><span class="line">        <span class="comment"># 注意这里依赖被转移到了factory</span></span><br><span class="line">        <span class="comment"># App 中的逻辑代码不再依赖于 Robot 的具体组装和实现</span></span><br><span class="line">        self.robot: RobotI = factory.create()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    factory = MetalDigitalRobotFactory()</span><br><span class="line">    app = App(factory)</span><br></pre></td></tr></table></figure>

<p>这里，我们可以通过增加新的工厂轻松的拓展我们的代码，而不用触碰已有的代码。下游的控制类并不需要<br>知道制造机器人的复杂度，因为他们不负责实例化机器人，也不必知道机器人的类型，因为他们是针对接口<br>编程的。</p>
<p>不过，在Python这类动态语言中，我们可以简化工厂类成几个函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_metal_digital_robot</span>() -&gt; RobotI:</span></span><br><span class="line">    shell = MetalShell() </span><br><span class="line">    soul = DigitalSoul()</span><br><span class="line">    <span class="keyword">return</span> Robot(shell, soul)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, factory: <span class="built_in">callable</span></span>):</span></span><br><span class="line">        self.robot: RobotI = factory()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    factory = MetalDigitalRobotFactory()</span><br><span class="line">    app = App(factory = create_metal_digital_robot)</span><br></pre></td></tr></table></figure>

<h3 id="建造者，Builder"><a href="#建造者，Builder" class="headerlink" title="建造者，Builder"></a>建造者，Builder</h3><p>建造者模式其实与抽象工厂异曲同工，都是把一个复杂的对象实例化过程封装在一个对象里，而这个builder<br>抽象通过他不同的实现，生产不同的对象。</p>
<h3 id="单例，Singleton"><a href="#单例，Singleton" class="headerlink" title="单例，Singleton"></a>单例，Singleton</h3><p>单例其实就是一个特殊的工厂，他的<code>create</code>方法永远返回唯一的一个对象，这里是指在同一个内存地址的<br>同一个对象。只不过，按照惯例，Singleton的创造方法一般被叫做<code>get_instance</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span>:</span></span><br><span class="line">    _instance = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls</span>):</span></span><br><span class="line">        <span class="keyword">if</span> cls._instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># 如果不存在，就创建一个对象</span></span><br><span class="line">            cls._instance = <span class="built_in">super</span>(Singleton, cls).__new__(cls)</span><br><span class="line">        <span class="comment"># 永远返回同一对象。</span></span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br></pre></td></tr></table></figure>

<h3 id="原型，Prototype"><a href="#原型，Prototype" class="headerlink" title="原型，Prototype"></a>原型，Prototype</h3><p>原型试图解决的是另一个问题：如果复制一个对象。之前的讨论的模式都是如何初始化（实例化）一个对象。<br>即实现一个 <code>clone</code> 方法。这样做的好处是把复制对象的任务交个对象自己完成，不需要暴露内部状态<br>给客户端。</p>
<p>如果是Python实现的话，只需要实现<code>__copy__</code> 和 <code>__deepcopy__</code> 即可。当然也可以使用经典的<br><code>clone</code>接口。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>其实这几个创造模式围绕的核心都是：面向接口编程 和 延迟创建。无论是抽象工厂、单例、原型，他们<br>管理依赖的基石都是通过接口，接口隐藏了细节和复杂度（比如复杂的构造过程、复杂的拷贝过程等等）。<br>也正是因为有了接口，我们就把创建类的任务委托给了其他对象。</p>
<h2 id="结构模式，Structural-Patterns"><a href="#结构模式，Structural-Patterns" class="headerlink" title="结构模式，Structural Patterns"></a>结构模式，Structural Patterns</h2><p>结构模式主要是针对如何把不同的数据（对象）放在一起。我们会分析如下设计模式：</p>
<ul>
<li>组合，Composite</li>
<li>转换器，Adapter</li>
<li>代理，Proxy</li>
<li>装饰器，Decorator</li>
<li>桥接，Bridge</li>
</ul>
<p>随着我们的分析会进一步发现，这些模式可以存在往往是因为原则1，即面向接口编程。</p>
<h3 id="组合，Composite"><a href="#组合，Composite" class="headerlink" title="组合，Composite"></a>组合，Composite</h3><p>在讨论创造模式的时候，我们看到很多模式对于动态语言来说显得过于啰嗦。<br>但是，无论在动态语言，还是静态语言中，组合模式是我认为非常有用且强大的模式。</p>
<p>组合模式适用于组织树状数据结构，组合模式通过结构可以让简单数据和由简单数据复合形成的<br>复杂结构共享同一个结构，实现“一视同仁”。</p>
<p>我们举个简单的例子，假设我们有两种对象：物品和盒子。盒子里面可以包含若干物品，也可以包含<br>更多的盒子。但是物品里面没有盒子，也就是说，物品是我们的最基对象，而盒子是复杂对象。<br>每一个物品都有一个价格，而盒子的价格等于其中物品价格的总和。那么，给出一个对象（盒子或<br>物品），我们需要计算他的价格。如何组织数据结构呢？</p>
<p>一种方式，我们一层一层遍历对象，判断如果是物品，提取价格，如果是盒子，进一步遍历。</p>
<p>另一种方法就是使用组合模式，让基本对象（物品）和复合对象（盒子）共享一个接口，这样我们<br>就不需要判断对象的类型，实现递归。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> abstractmethod, ABC</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThingI</span>(<span class="params">ABC</span>):</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">price</span>(<span class="params">self</span>) -&gt; <span class="built_in">float</span>:</span></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span>(<span class="params">ThingI</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, price</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self._price = price</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">price</span>(<span class="params">self</span>) -&gt; <span class="built_in">float</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._price</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Box</span>(<span class="params">ThingI</span>):</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, contents: <span class="type">List</span>[ThingI]</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="comment"># 假设没有循环出现</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.contents = contents</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">price</span>(<span class="params">self</span>) -&gt; <span class="built_in">float</span>:</span></span><br><span class="line">        sum_price = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> self.contents:</span><br><span class="line">            sum_price += item.price()</span><br><span class="line">        <span class="keyword">return</span> sum_price</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    </span><br><span class="line">    a = Product(<span class="number">1.0</span>)</span><br><span class="line">    b = Product(<span class="number">1.0</span>)</span><br><span class="line">    c = Box(contents=[</span><br><span class="line">        Product(<span class="number">1.0</span>),</span><br><span class="line">        Box(</span><br><span class="line">            contents=[</span><br><span class="line">                Product(<span class="number">1.0</span>)</span><br><span class="line">            ]</span><br><span class="line">        ),</span><br><span class="line">        Box(</span><br><span class="line">            contents=[</span><br><span class="line">                a, b</span><br><span class="line">            ]</span><br><span class="line">        )</span><br><span class="line">    ])</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Price of c is <span class="subst">&#123;c.price()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure>

<p>如上面的例子，我们把计算和遍历对象内部状态的事情留给了对象自己，调用者完全不需要知道对象那种<br>类型，也无需知道内部的状态，它仅仅通过调用接口即可。这种通过接口统一不用对象的方法非常实用。<br>当然传统的设计模式中，复合对象（本例中的盒子）还会有一些特殊的方法，比如用来增加和减少他自己的<br>子对象等等。不过加入这些方法，可能会打破基本类型和复合类型的对称性，在后续的代码编写过程中<br>可能会造成问题。</p>
<h3 id="转换器、桥接、装饰器、代理"><a href="#转换器、桥接、装饰器、代理" class="headerlink" title="转换器、桥接、装饰器、代理"></a>转换器、桥接、装饰器、代理</h3><p>这四种模式其实有类似的地方，他们都是通过在原有的对象之间增加一个兼容两边的接口，实现对不同类型<br>的组合。转换器与桥接的主要区别在于，转换器通常是在软件开发的后续过程中由于增加新的功能，需要<br>协调已经有的部分；而桥接主要是在软件设计阶段。其实某种程度上，我们的机器人例子中的组装工厂就<br>有点桥接的意思了。桥接主要是通过对象面A对其他的对象B的结构编程，从而解耦合A和B的具体实现。</p>
<p>代理和装饰器则是通过实现一个与原对象相同的接口，从而实现对原有功能的一个拓展或者更改。设计模式<br>里面的装饰器模式跟Python的装饰器并不是同一个事情，但是实际上实现的功能非常类似。只不过Python<br>的装饰器主要是针对函数的，而函数本身也确实没有类型（其实有，但是对于Python真的不重要）。</p>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>通过上述分析，可以发现接口在组织数据结构对象和解耦合方面有奇效。依然贯彻面对接口编程的原则。</p>
<h2 id="行为模式，Behavior-Patterns"><a href="#行为模式，Behavior-Patterns" class="headerlink" title="行为模式，Behavior Patterns"></a>行为模式，Behavior Patterns</h2><p>行为模式强调的是对象之间的计算和互动模式。主要涉及：</p>
<ul>
<li>访问者，Visitor</li>
<li>观察者，Observer</li>
<li>命令，Command</li>
<li>迭代器，Iterator</li>
<li>备忘录，Memento</li>
<li>策略，Strategy</li>
<li>状态机，State</li>
</ul>
<p>这类设计模式比较丰富，不同语言特性实现出来的风格迥异，但是他们蕴含的设计里面才是精华。</p>
<h3 id="访问者，Visitor"><a href="#访问者，Visitor" class="headerlink" title="访问者，Visitor"></a>访问者，Visitor</h3><p>访问者模式强调分离同一个数据对象与他的算法。经典的实现如下代码，其核心部分是 <code>Visitor</code> 这个<br>结构以及每一个被访问的对象的 <code>accept</code> 方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Visitor</span>(<span class="params">ABC</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Visitor Interface declares a set of visiting methods that correspond to</span></span><br><span class="line"><span class="string">    component classes. The signature of a visiting method allows the visitor to</span></span><br><span class="line"><span class="string">    identify the exact class of the component that it&#x27;s dealing with.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">visit_concrete_component_a</span>(<span class="params">self, element: ConcreteComponentA</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">visit_concrete_component_b</span>(<span class="params">self, element: ConcreteComponentB</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Component</span>(<span class="params">ABC</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Component interface declares an `accept` method that should take the</span></span><br><span class="line"><span class="string">    base visitor interface as an argument.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">accept</span>(<span class="params">self, visitor: Visitor</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponentA</span>(<span class="params">Component</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Each Concrete Component must implement the `accept` method in such a way</span></span><br><span class="line"><span class="string">    that it calls the visitor&#x27;s method corresponding to the component&#x27;s class.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">accept</span>(<span class="params">self, visitor: Visitor</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        visitor.visit_concrete_component_a(self)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">exclusive_method_of_concrete_component_a</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot; Concrete Components may have special methods that don&#x27;t exist in their</span></span><br><span class="line"><span class="string">        base class or interface. The Visitor is still able to use these methods</span></span><br><span class="line"><span class="string">        since it&#x27;s aware of the component&#x27;s concrete class.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;A&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponentB</span>(<span class="params">Component</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Same here: visitConcreteComponentB =&gt; ConcreteComponentB &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">accept</span>(<span class="params">self, visitor: Visitor</span>):</span></span><br><span class="line">        visitor.visit_concrete_component_b(self)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">special_method_of_concrete_component_b</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;B&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteVisitor1</span>(<span class="params">Visitor</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">visit_concrete_component_a</span>(<span class="params">self, element</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;element.exclusive_method_of_concrete_component_a()&#125;</span> + ConcreteVisitor1&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">visit_concrete_component_b</span>(<span class="params">self, element</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;element.special_method_of_concrete_component_b()&#125;</span> + ConcreteVisitor1&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteVisitor2</span>(<span class="params">Visitor</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">visit_concrete_component_a</span>(<span class="params">self, element</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;element.exclusive_method_of_concrete_component_a()&#125;</span> + ConcreteVisitor2&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">visit_concrete_component_b</span>(<span class="params">self, element</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;element.special_method_of_concrete_component_b()&#125;</span> + ConcreteVisitor2&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">client_code</span>(<span class="params">components: <span class="type">List</span>[Component], visitor: Visitor</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The client code can run visitor operations over any set of elements without</span></span><br><span class="line"><span class="string">    figuring out their concrete classes. The accept operation directs a call to</span></span><br><span class="line"><span class="string">    the appropriate operation in the visitor object.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="keyword">for</span> component <span class="keyword">in</span> components:</span><br><span class="line">        component.accept(visitor)</span><br><span class="line">    <span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<h3 id="观察者，Observer"><a href="#观察者，Observer" class="headerlink" title="观察者，Observer"></a>观察者，Observer</h3><p>这种设计模式可以说非常常见了，观察者也就是我们经常听到的广播订阅模式。这种模式如今已经走出了<br>设计模式的范畴，在架构领域也是经常见到，比如我们常见的Kafka就是这种设计模式实现的中间件。</p>
<p>同时，与访问者对比，观察者会被动得到通知，而访问者需要主动要求 (调用<code>accept</code>)。</p>
<p>经典的实现如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Subject</span>(<span class="params">ABC</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Subject interface declares a set of methods for managing subscribers.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">attach</span>(<span class="params">self, observer: Observer</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Attach an observer to the subject.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">detach</span>(<span class="params">self, observer: Observer</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Detach an observer from the subject.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">notify</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Notify all observers about an event.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteSubject</span>(<span class="params">Subject</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; The Subject owns some important state and notifies observers when the state</span></span><br><span class="line"><span class="string">    changes.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    _state: <span class="built_in">int</span> = <span class="literal">None</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; For the sake of simplicity, the Subject&#x27;s state, essential to all</span></span><br><span class="line"><span class="string">    subscribers, is stored in this variable.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    _observers: <span class="type">List</span>[Observer] = []</span><br><span class="line">    <span class="string">&quot;&quot;&quot; List of subscribers. In real life, the list of subscribers can be stored</span></span><br><span class="line"><span class="string">    more comprehensively (categorized by event type, etc.).</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">attach</span>(<span class="params">self, observer: Observer</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Subject: Attached an observer.&quot;</span>)</span><br><span class="line">        self._observers.append(observer)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">detach</span>(<span class="params">self, observer: Observer</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        self._observers.remove(observer)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">notify</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot; Trigger an update in each subscriber.  &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Subject: Notifying observers...&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> observer <span class="keyword">in</span> self._observers:</span><br><span class="line">            observer.update(self)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">some_business_logic</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nSubject: I&#x27;m doing something important.&quot;</span>)</span><br><span class="line">        self._state = randrange(<span class="number">0</span>, <span class="number">10</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Subject: My state has just changed to: <span class="subst">&#123;self._state&#125;</span>&quot;</span>)</span><br><span class="line">        self.notify()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span>(<span class="params">ABC</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; The Observer interface declares the update method, used by subjects.  &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self, subject: Subject</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot; Receive update from subject.  &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserverA</span>(<span class="params">Observer</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self, subject: Subject</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> subject._state &lt; <span class="number">3</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;ConcreteObserverA: Reacted to the event&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserverB</span>(<span class="params">Observer</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self, subject: Subject</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> subject._state == <span class="number">0</span> <span class="keyword">or</span> subject._state &gt;= <span class="number">2</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;ConcreteObserverB: Reacted to the event&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># The client code.</span></span><br><span class="line"></span><br><span class="line">    subject = ConcreteSubject()</span><br><span class="line"></span><br><span class="line">    observer_a = ConcreteObserverA()</span><br><span class="line">    subject.attach(observer_a)</span><br><span class="line"></span><br><span class="line">    observer_b = ConcreteObserverB()</span><br><span class="line">    subject.attach(observer_b)</span><br><span class="line"></span><br><span class="line">    subject.some_business_logic()</span><br><span class="line">    subject.some_business_logic()</span><br><span class="line"></span><br><span class="line">    subject.detach(observer_a)</span><br><span class="line"></span><br><span class="line">    subject.some_business_logic()</span><br></pre></td></tr></table></figure>

<h3 id="命令，Command"><a href="#命令，Command" class="headerlink" title="命令，Command"></a>命令，Command</h3><p>命令模式在如今的软件工程中也非常常见，它其实是一种对象之间的通讯方式，命令模式会把一个请求<br>转换成包含完成这个命令的信息的独立对象，这个命令对象随后可以被发送给命令的执行对象执行。<br>从而实现了发送者和接受者的解耦合。看起来与观察者有一点类似，命令的执行者可以算是某种命令的<br>观察者。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Command</span>(<span class="params">ABC</span>):</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">execute</span>(<span class="params">self</span>):</span></span><br><span class="line">        ...</span><br><span class="line">        </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleCommand</span>(<span class="params">Command</span>):</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, payload: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        self._payload = payload</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">execute</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;SimpleCommand execute with <span class="subst">&#123;self._payload&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ComplexCommand</span>(<span class="params">Command</span>):</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, receiver: Receiver, a, b</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        self._a = a</span><br><span class="line">        self._b = b</span><br><span class="line">        self._receiver = receiver</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">execute</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;ComplexCommand execute with <span class="subst">&#123;self._receiver&#125;</span>&quot;</span>)</span><br><span class="line">        self._receiver.do_a(self._a)</span><br><span class="line">        self._receiver.do_b(self._b)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Receiver</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 包含了业务逻辑，即知道如何响应命令。 &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_a</span>(<span class="params">self, a: <span class="built_in">str</span></span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self&#125;</span> do a with <span class="subst">&#123;a&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_b</span>(<span class="params">self, b: <span class="built_in">str</span></span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self&#125;</span> do b with <span class="subst">&#123;b&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Invoker</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;  &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_on_start</span>(<span class="params">self, command: Command</span>):</span></span><br><span class="line">        self._on_start = command</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_on_finish</span>(<span class="params">self, command: Command</span>):</span></span><br><span class="line">        self._on_finish = command</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_something_important</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(self._on_start, Command):</span><br><span class="line">            self._on_start.execute()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(self._on_finish, Command):</span><br><span class="line">            self._on_finish.execute()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    invoker = Invoker()</span><br><span class="line">    invoker.set_on_start(SimpleCommand(<span class="string">&quot;Say Hi!&quot;</span>))</span><br><span class="line">    receiver = Receiver()</span><br><span class="line">    invoker.set_on_finish(ComplexCommand(</span><br><span class="line">        receiver, <span class="string">&quot;Send email&quot;</span>, <span class="string">&quot;Save report&quot;</span>))</span><br><span class="line">    invoker.do_something_important()</span><br></pre></td></tr></table></figure>

<h3 id="迭代器，Iterator"><a href="#迭代器，Iterator" class="headerlink" title="迭代器，Iterator"></a>迭代器，Iterator</h3><p>迭代器是关于如何遍历数据结构的模式。比如一个树结构，我们可以通过定义迭代器接口方法：<code>iterator</code> 来抽象不同的遍历风格，比如深度优先、广度优先等等。</p>
<h3 id="备忘录，Memento"><a href="#备忘录，Memento" class="headerlink" title="备忘录，Memento"></a>备忘录，Memento</h3><p>备忘录是一种在不打破对象封装的前提下，对对象进行快照的方法，通过快照我们可以方便的进行历史重现。其核心在于把管理快照的功能交给其他对象。在Python中快照可以通过不同的序列化实现。</p>
<h3 id="策略，Strategy"><a href="#策略，Strategy" class="headerlink" title="策略，Strategy"></a>策略，Strategy</h3><p>策略模式其实就是为算法定义一个接口，从而实现随意插入任意具体算法的模式。可以参考机器人的例子。<br>抽象工厂可以理解成某个工厂算法。</p>
<h3 id="状态机，State"><a href="#状态机，State" class="headerlink" title="状态机，State"></a>状态机，State</h3><p>状态机也是非常常见的设计模式，也就是一个对象的行为，取决于它内部的状态；而他对事件的相应，也会<br>影响他内部的状态。我认为是一种与组合模式同样影响深远的模式。状态机会把这些复杂度封装在对象内部<br>而不会让客户端通过一些if语句来控制。同样，这也是一种责任交付。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Context 是包含 State 的对象，也就是 state 的客户端 &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    _state = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, state: State</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        self.transition_to(state)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">transition_to</span>(<span class="params">self, state: State</span>):</span></span><br><span class="line">        self._state = state</span><br><span class="line">        self._state.context = self</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">request1</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._state.handle1()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">request2</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._state.handle2()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">State</span>(<span class="params">ABC</span>):</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">context</span>(<span class="params">self</span>) -&gt; Context:</span></span><br><span class="line">        <span class="keyword">return</span> self._context</span><br><span class="line"></span><br><span class="line"><span class="meta">    @context.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">context</span>(<span class="params">self, context: Context</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        self._context = context</span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle1</span>(<span class="params">self</span>):</span></span><br><span class="line">        ...</span><br><span class="line">        </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle2</span>(<span class="params">self</span>):</span></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 我们的状态机有两个状态，A 和 B</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStateA</span>(<span class="params">State</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle1</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ConcreteStateA handles request1.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ConcreteStateA wants to change the state of the context.&quot;</span>)</span><br><span class="line">        self.context.transition_to(ConcreteStateB())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle2</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ConcreteStateA handles request2.&quot;</span>)    </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStateB</span>(<span class="params">State</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle1</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ConcreteStateB handles request1.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle2</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ConcreteStateB handles request2.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ConcreteStateB wants to change the state of the context.&quot;</span>)</span><br><span class="line">        self.context.transition_to(ConcreteStateA())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    context = Context(ConcreteStateA())</span><br><span class="line">    context.request1()</span><br><span class="line">    context.request2()</span><br></pre></td></tr></table></figure>

<h2 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h2><p>可以看出，设计模式主要使用的技巧就是：</p>
<ul>
<li>面对接口编程</li>
<li>延迟执行</li>
<li>依赖注入</li>
<li>组合 而不是 继承</li>
</ul>
<p>在上面的例子中，所有的继承都紧紧是接口的一种实现，并不是真正意义的共享状态，而是共享合同。<br>这种共享接口让程序变更加容易拓展。依赖注入可以看成某种延迟执行。</p>
<p>当然，不同的语言特性会让这些模式实现看起来非常不一样，比如采用鸭子类型的语言，Python或者Go，<br>很多继承是不需要的，我们只需要duck type接口的方法即可。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://refactoring.guru/design-patterns">https://refactoring.guru/design-patterns</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/faif/python-patterns">https://github.com/faif/python-patterns</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Design-Pattern/" rel="tag"># Design Pattern</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/09/04/flink_raspberrypi/" rel="prev" title="树莓派搭建流计算集群">
                  <i class="fa fa-angle-left"></i> 树莓派搭建流计算集群
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/10/10/%E8%87%AA%E5%AD%A6%E8%AE%A1%E7%AE%97%E6%9C%BA5%E5%B9%B4/" rel="next" title="自学计算机的5年">
                  自学计算机的5年 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">FunCoder</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Word count total">423k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">6:24</span>
  </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
